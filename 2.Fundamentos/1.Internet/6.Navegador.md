# O que é um navegador?

Um navegador da web é um programa de software que permite ao usuário acessar informações na Internet através da World Wide Web.

## Evolução Inicial

O WorldWideWeb, criado por Tim Berners-Lee em 1990, foi o primeiro navegador, com funções limitadas de exibição de páginas em texto. A evolução começou em 1991 com um navegador para terminais antigos, seguido pelo Mosaico em 1993, que introduziu imagens. As "guerras dos navegadores" começaram no meio da década de 1990, com o surgimento do Netscape e, posteriormente, do Internet Explorer.

### Navegadores Modernos

Atualmente, o cenário é diversificado, incluindo:

- **Google Chrome:** Rápido e popular, integra bem com serviços do Google;
- **Mozilla Firefox:** Focado em privacidade e personalização;
- **Safari:** Integrado ao ecossistema Apple;
- **Microsoft Edge:** Sucessor do Internet Explorer, com boas funcionalidades de segurança;
- **Opera:** Oferece recursos únicos, como uma VPN integrada.

## Como funciona?

### Mecanismo de Renderização

O mecanismo de renderização é um componente fundamental dos navegadores, responsável por converter o código de um site em elementos visuais em uma página da web. Ele interpreta instruções do navegador e constrói a representação visual da página. Alguns dos principais mecanismos incluem:

- **Blink:** Utilizado pelo Google Chrome, é conhecido por sua velocidade e eficiência;
- **WebKit:** Empregado no Safari, fornece robustez para renderizar páginas complexas;
- **Gecko:** Usado no Mozilla Firefox, foca no desenvolvimento de código aberto e conformidade com padrões.

### Navegação

A navegação é o primeiro passo para carregar uma página web, ocorrendo sempre que um usuário solicita uma página, seja digitando uma URL, clicando em um link ou enviando um formulário. Minimizar o tempo de navegação é um objetivo importante para o desempenho da web, mas fatores como latência e largura de banda podem causar atrasos.

#### Pesquisa DNS

O primeiro passo da navegação é localizar os ativos da página. Quando você acessa um site (por exemplo, https://example.com), o navegador solicita uma pesquisa DNS para obter o endereço IP do servidor. Se nunca visitou o site, uma pesquisa DNS é realizada, que é geralmente armazenada em cache para acelerar futuras solicitações. Cada hostname único requer uma nova pesquisa DNS, o que pode ser problemático, especialmente em redes móveis, devido à latência adicional.

#### Estabelecimento de Conexão
Uma vez conhecido o endereço IP, o navegador configura uma conexão com o servidor via um "handshake" TCP de três etapas, conhecido como SYN-SYN-ACK. Para conexões seguras, um handshake TLS adicional é necessário para determinar os métodos de criptografia e verificar o servidor. Isso adiciona mais cinco idas e vindas antes de a solicitação de conteúdo ser enviada.

#### Resposta do Servidor

Depois de estabelecer a conexão, o navegador envia uma solicitação HTTP GET, normalmente para um arquivo HTML. A resposta do servidor inclui cabeçalhos e o conteúdo HTML, conhecido como Tempo até o Primeiro Byte (TTFB), que mede o tempo entre a solicitação e o recebimento do primeiro pacote de dados.

#### Controle de Congestionamento e TCP

Os pacotes TCP são divididos em segmentos e exigem confirmações (ACK) para manter a sequência. O algoritmo TCP Slow Start ajusta gradualmente a quantidade de dados transmitidos para otimizar o desempenho e evitar congestionamentos.

##### Análise e Construção do DOM

Após receber dados, o navegador inicia a análise para criar o DOM e CSSOM, que são utilizados para renderizar a página. A construção do DOM envolve a tokenização e criação da árvore, refletindo a hierarquia dos elementos HTML. A análise de recursos não bloqueantes, como imagens, é feita em paralelo, enquanto scripts sem atributos async ou defer bloqueiam a renderização.

#### Construção da Árvore CSSOM

A construção da CSSOM, que contém as regras de estilo, segue um processo semelhante ao do DOM. No geral, a construção da CSSOM é rápida e menor que o tempo de uma pesquisa DNS.

#### Renderização

A renderização envolve quatro etapas: estilo, layout, pintura, e às vezes composição. As árvores DOM e CSSOM são combinadas em uma árvore de renderização para calcular o layout de cada elemento. O layout determina a geometria e a localização, e reflows ocorrem quando são feitas recalculações.

As renderizações posteriores são afetadas por bloqueios de recursos e tamanho de viewport, e o tamanho e posição dos elementos são determinados em relação ao viewport.

#### Pintura

A última etapa do caminho crítico de renderização é a pintura, onde os nós individuais são desenhados na tela. A primeira vez que isso acontece é chamada de Primeiro Pintar Significativo. Durante essa fase, o navegador converte cada caixa calculada na fase de layout em pixels reais na tela, desenhando todos os elementos visuais, como texto, cores, bordas, sombras e elementos substituídos (como botões e imagens). Esta operação precisa ser realizada rapidamente.

Para assegurar uma rolagem e animação suaves, o tempo total para calcular estilos, reflow e pintura deve ser inferior a 16,67 ms. Em dispositivos como o iPad com resolução de 2048 x 1536, mais de 3.145.000 pixels devem ser pintados rapidamente. A pintura é frequentemente dividida em várias camadas para otimizar a velocidade do processo. Camadas podem ser promovidas para a GPU, melhorando a performance de pintura e repintura. No entanto, o uso excessivo de camadas pode aumentar o custo de gerenciamento de memória.

#### Composição

Quando partes do documento são desenhadas em diferentes camadas, a composição é necessária para garantir que sejam exibidas na ordem correta. Durante o carregamento de ativos, ocorrem reflows que podem provocar repinturas e novas composições. Se as dimensões de um elemento, como uma imagem, fossem definidas, evitaríamos reflows desnecessários e somente a camada que necessita de repintura seria afetada.

#### Interatividade

Após a pintura da página ser concluída, a interatividade pode ainda ser afetada. Se o carregamento incluir JavaScript que é corretamente adiado e só executado após o evento de carregamento, o main thread pode estar ocupado, dificultando interações como rolagem ou toque, resultando em uma má experiência de usuário.

O Tempo para Interatividade (TTI) mede o tempo necessário desde a primeira solicitação até que a página se torne interativa — nesse contexto, interativa é quando a página responde a interações do usuário em até 50 ms. Se o main thread estiver ocupado com JavaScript, não responderá a essas interações de forma oportuna.

Por exemplo, pode haver rápido carregamento da imagem, mas se um arquivo JavaScript for grande (2MB) e a conexão do usuário for lenta, a página será exibida rapidamente, mas a interação pode ser lenta até que o JavaScript seja carregado e executado. Um exemplo de má experiência de usuário é quando a execução do JavaScript ocupa o main thread por mais de 1,5 segundos, tornando-o não responsivo a eventos de clique ou toques.